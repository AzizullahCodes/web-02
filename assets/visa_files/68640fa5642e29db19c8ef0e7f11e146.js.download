"use strict";jQuery(function($){aikitChatbot.previousMessages=[];let isLivePreview=!1;$(".aikit-deactivated-form *").prop('disabled',!0);$(".aikit-chatbot-send-button").click(function(event){event.preventDefault();sendChatbotMessage()});$("#aikit-new-message-textarea").keypress(function(event){if(event.shiftKey){return}
if(event.keyCode===13){event.preventDefault();sendChatbotMessage()}});$(".aikit-open-chat-button").click(function(){$(".aikit-chat-container").fadeIn(100,function(){$(".aikit-open-chat-button").fadeOut(100);$(".aikit-chatbot-send-button").fadeIn(100);$(".aikit-chat-widget").addClass('aikit-open')})});$(".aikit-exit-chat").click(function(){$(".aikit-chat-container").fadeOut(100,function(){$(".aikit-open-chat-button").fadeIn(100);$(".aikit-chatbot-send-button").fadeOut(100);$(".aikit-chat-widget").removeClass('aikit-open')})});if($('.aikit-chat-widget').data('default-view')==='collapsed'){$(".aikit-chat-container").hide()}else{$(".aikit-open-chat-button").hide();$(".aikit-chat-widget").addClass('aikit-open')}
const sendChatbotMessage=()=>{let message=$("#aikit-new-message-textarea").val();if(message===''){return}
if($(".aikit-chatbot-send-button").prop('disabled')){return}
$(".aikit-chatbot-send-button").prop('disabled',!0);$(".aikit-chatbot-send-button").css('opacity','0.5');addMessageToChat(message,"reply");let loading=$('<div class="aikit-message aikit-message-bot">\n'+'                                    <span class="aikit-message-content">\n'+'                                        <span class="aikit-typing">\n'+'                                            <span class="aikit-dot"></span>\n'+'                                            <span class="aikit-dot"></span>\n'+'                                            <span class="aikit-dot"></span>\n'+'                                        </span>\n'+'                                    </span>\n'+'                                </div>');$("#aikit-messages").append(loading);loading.hide().fadeIn(300);$("#aikit-conversation").animate({scrollTop:$("#aikit-conversation").prop("scrollHeight")},50);if(isLivePreview){setTimeout(function(){loading.remove();addMessageToChat("This is a test message from the live preview.");$(".aikit-chatbot-send-button").prop('disabled',!1);$(".aikit-chatbot-send-button").css('opacity','1')},2000);$("#aikit-new-message-textarea").val('');return}
$.ajax({type:"POST",url:aikitChatbot.siteUrl+'/?rest_route=/aikit/chatbot/v1/chat',data:JSON.stringify({message:message,previous_messages:JSON.stringify(aikitChatbot.previousMessages),page_content:aikitChatbot.pageContent,chat_id:$(".aikit-chat-widget").data('chat-id'),}),dataType:"json",encode:!0,headers:{'Content-Type':'application/json','X-WP-Nonce':aikitChatbot.nonce,},}).done(function(data){aikitChatbot.previousMessages.push({message:message,author:'user',});aikitChatbot.previousMessages.push({message:data.message,author:'assistant',});data.message=data.message.replace(/\n/g,'<br>');data.message=data.message.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>');loading.remove();addMessageToChat(data.message);$(".aikit-chatbot-send-button").prop('disabled',!1);$(".aikit-chatbot-send-button").css('opacity','1')}).fail(function(data){if(data.responseJSON){data=data.responseJSON}
if(data.show_in_alert===!0){alert(data.message)}else{console.log(data)}
addMessageToChat(data.chat_error,"error");$(".aikit-chatbot-send-button").prop('disabled',!1);$(".aikit-chatbot-send-button").css('opacity','1');loading.remove()});$("#aikit-new-message-textarea").val('')}
const addMessageToChat=(message,type="")=>{let className="aikit-message-bot";if(type==="reply"){className="aikit-message-user"}else if(type==="error"){className="aikit-message-error"}
let bubble=$('<div class="aikit-message  '+className+'"><span className="aikit-message-content">'+message+'</span></div>');$("#aikit-messages").append(bubble);bubble.hide().fadeIn(100);$("#aikit-conversation").animate({scrollTop:$("#aikit-conversation").prop("scrollHeight")},50)}
const generateBotStyles=()=>{let secondaryColor=hashColorToRgb(aikitChatbot.secondaryColor,1);let mainColor=hashColorToRgb(aikitChatbot.mainColor,1);let shadowColor=hashColorToRgb(aikitChatbot.mainColor,.6);let loadingColor=hashColorToRgb(aikitChatbot.mainColor,.7);let dot1=hashColorToRgb(aikitChatbot.mainColor,.7);let dot2=hashColorToRgb(aikitChatbot.mainColor,.4);let dot3=hashColorToRgb(aikitChatbot.mainColor,.2);let titleColor=hashColorToRgb(aikitChatbot.titleColor,0.9);$("#aikit-chatbot-style").remove();let style='<style id="aikit-chatbot-style">';style+='.aikit-message-bot {';style+='    background-color: '+aikitChatbot.aiMessageBubbleColor+';';style+='    color: '+aikitChatbot.aiMessageTextColor+';';style+='}';style+='.aikit-chat-bubble a {';style+='    text-decoration: underline;';style+='}';style+='.aikit-message-user {';style+='    background: linear-gradient(135deg, '+aikitChatbot.userMessageBubbleColor+','+secondaryColor+');';style+='    color: '+aikitChatbot.userMessageTextColor+';';style+='}';style+='.aikit-chat-header {';style+='    background: linear-gradient(135deg, '+mainColor+' 0%,'+secondaryColor+' 100%);';style+='    color: '+aikitChatbot.titleColor+';';style+='}';style+='.aikit-button-body {';style+='    background: linear-gradient(135deg, '+mainColor+','+secondaryColor+');';style+='    box-shadow: '+shadowColor+' 0px 4px 24px;;';style+='}';style+='.aikit-button i svg, .aikit-down-arrow {';style+='    color: '+titleColor+';';style+='}';style+='.aikit-typing .aikit-dot {';style+='    background-color: '+loadingColor+';';style+='}';style+=' @keyframes mercuryTypingAnimation {';style+='    0% {';style+='        transform: translateY(0px);';style+='        background-color: '+dot1+';';style+='    }';style+='    28% {';style+='        transform: translateY(-7px);';style+='        background-color: '+dot2+';';style+='    }';style+='    44% {';style+='        transform: translateY(0px);';style+='        background-color: '+dot3+';';style+='    }';style+='}';style+='</style>';$('head').append(style)}
const activateLivePreview=()=>{isLivePreview=!0;$("input").on('input',function(){let setting=$(this).attr('data-setting');if(aikitChatbot[setting]!==undefined){aikitChatbot[setting]=$(this).val()}
updateLivePreview()});updateLivePreview()}
const hashColorToRgb=(color,opacity)=>{let colorRgb=color.replace('#','');colorRgb=colorRgb.match(/.{1,2}/g);colorRgb='rgba('+parseInt(colorRgb[0],16)+','+parseInt(colorRgb[1],16)+','+parseInt(colorRgb[2],16)+', '+opacity+')';return colorRgb}
const updateLivePreview=()=>{generateBotStyles();let title=$("#aikit-chatbot-appearance-title").val();$(".aikit-chat-welcome span").html(title);let firstMessage=$("#aikit-chatbot-appearance-start-message").val();$(".aikit-message:first").html(firstMessage);let inputTextPlaceholder=$("#aikit-chatbot-appearance-input-placeholder").val();$("#aikit-new-message-textarea").attr('placeholder',inputTextPlaceholder)}
generateBotStyles();$('.aikit-chat-widget').removeClass('d-none');if(window.location.href.indexOf('page=aikit_chatbot')>-1){activateLivePreview()}})
;